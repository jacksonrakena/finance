# Maybe Finance Codebase Conventions

## Core Development Guidelines

### Essential Rules
- Use `Current.user` for the current user (NOT `current_user`)
- Use `Current.family` for the current family (NOT `current_family`)
- Read project design and conventions before generating code
- Hardcode strings in English (ignore i18n for development speed)

### Prohibited Actions
- Do not run `rails server`
- Do not run `touch tmp/restart.txt`
- Do not run `rails credentials`
- Do not automatically run migrations

## Tech Stack
- **Web framework**: Ruby on Rails
  - Minitest + fixtures for testing
  - Propshaft for asset pipeline
  - Hotwire Turbo/Stimulus for SPA-like UI/UX
  - TailwindCSS for styles
  - Lucide Icons for icons
  - OpenAI for AI chat
- **Database**: PostgreSQL
- **Jobs**: Sidekiq + Redis
- **External Services**:
  - Payments: Stripe
  - User bank data syncing: Plaid
  - Market data: Synth (custom API)

## Core Conventions

### 1. Minimize Dependencies
Dependencies are natural but we aim to minimize them for maintainability:
- Push Rails to its limits before adding new dependencies
- Strong technical/business justification required for new deps
- Favor old and reliable over new and flashy

### 2. Fat Models, Skinny Controllers
Adopt "skinny controller, fat models" with everything in `app/models/`:
- Use POROs and concerns over service objects
- Avoid separate `app/services/` folders
- Organize with Rails concerns for model "traits"
- Concerns can be "one-off" for organization, not just shared functionality
- Models should answer questions about themselves
- Example: `account.balance_series` vs `AccountSeries.new(account).call`

### 3. Hotwire-First Development
Leverage native HTML, CSS, JS with server-side solutions:
- **Native HTML preferred** over JS components:
  - Use `<dialog>` for modals
  - Use `<details><summary>` for disclosures
- **Turbo frames** over JS-driven client-side solutions
- **Query params** for state over localStorage/sessions
- **Server-side formatting** for currencies, numbers, dates
- **Client-side code** only where it truly shines (e.g., bulk selection)
- **Always use `icon` helper**, never `lucide_icon` directly

### 4. Optimize for Simplicity
All code should maximize readability and simplicity:
- Prioritize good OOP domain design over performance
- Focus on performance only for critical/global areas
- Avoid N+1 queries
- Don't sweat the small stuff

### 5. Database Strategy
- **Simple validations in DB**: null checks, unique indexes
- **ActiveRecord validations** may mirror DB ones for form convenience
- **Complex validations** and business logic stay in ActiveRecord
- **Client-side form validation** preferred when possible
- **Keep business logic out of DB**

## Continuous Improvement

### Rule Update Triggers
- New patterns used in 3+ files
- Common bugs that could be prevented
- Repeated code review feedback
- New security/performance patterns

### Pattern Recognition
- Monitor for repeated implementations
- Identify standardization opportunities
- Track common error patterns
- Watch for new tool adoption

### Quality Maintenance
- Keep examples synchronized with code
- Update external documentation references
- Cross-reference related guidelines
- Remove outdated patterns