# Stimulus Controller Guidelines

## Core Principles

### Use Declarative Actions, Not Imperative Event Listeners
Always write Controllers + ERB views declaratively by using Stimulus actions in ERB to call methods in the Stimulus JS controller.

#### BAD Code (Imperative):
```javascript
// BAD!!!! DO NOT DO THIS!!
// Imperative - controller does all the work
export default class extends Controller {
  static targets = ["button", "content"]

  connect() {
    this.buttonTarget.addEventListener("click", this.toggle.bind(this))
  }

  toggle() {
    this.contentTarget.classList.toggle("hidden")
    this.buttonTarget.textContent = this.contentTarget.classList.contains("hidden") ? "Show" : "Hide"
  }
}
```

#### GOOD Code (Declarative):
```erb
<!-- Declarative - HTML declares what happens -->
<div data-controller="toggle">
  <button data-action="click->toggle#toggle" data-toggle-target="button">Show</button>
  <div data-toggle-target="content" class="hidden">Hello World!</div>
</div>
```

```javascript
// Declarative - controller just responds
export default class extends Controller {
  static targets = ["button", "content"]

  toggle() {
    this.contentTarget.classList.toggle("hidden")
    this.buttonTarget.textContent = this.contentTarget.classList.contains("hidden") ? "Show" : "Hide"
  }
}
```

## Controller Design Guidelines

### Keep Controllers Lightweight and Simple
- **Always aim for less than 7 controller targets** - more indicates too much complexity
- Use private methods and expose a clear public API
- Single responsibility or group of highly related responsibilities

### Focus on What Stimulus Does Best
- **Domain logic does NOT belong** in a Stimulus controller
- Stimulus controllers should focus on DOM manipulation and user interaction
- Make good use of Stimulus's callbacks, actions, targets, values, and classes

### Component Controller Scope
- **Component controllers** (in `app/components/`) should **only be used within their component view**
- They should **not be used anywhere** in `app/views/`
- Global controllers can be used across the entire application

## Best Practices

### Data Passing
- Pass data from Rails to Stimulus using `data-*-value` attributes
- Avoid inline JavaScript for data passing
- Use Stimulus values API for configuration

### DOM Interaction
- Use Stimulus targets to reference DOM elements
- Avoid manual `getElementById` or `querySelector` calls
- Leverage Stimulus's declarative target system

### Event Handling
- Define actions in HTML using `data-action` attributes
- Keep event handling logic in controller methods
- Use Stimulus's action descriptor syntax for complex event handling

## Example Structure

```javascript
export default class extends Controller {
  static targets = ["input", "output", "button"]
  static values = { 
    url: String,
    timeout: Number 
  }
  static classes = ["loading", "error"]

  connect() {
    // Initialization logic only
  }

  // Public action methods
  submit(event) {
    event.preventDefault()
    this.#processForm()
  }

  reset() {
    this.inputTarget.value = ""
    this.#clearOutput()
  }

  // Private helper methods
  #processForm() {
    // Implementation details
  }

  #clearOutput() {
    this.outputTarget.textContent = ""
  }
}
```

This approach ensures controllers remain focused, testable, and maintainable while leveraging Stimulus's strengths in DOM manipulation and user interaction.